<!DOCTYPE html>
<html>

<head>
    <title>Nanonauten in actie</title>
</head>

<body>
    <script>
        // CONSTANTEN
        const CANVAS_BREEDTE = 800;
        const CANVAS_HOOGTE = 600;
        const NANONAUT_BREEDTE = 181;
        const NANONAUT_HOOGTE = 229;
        const GROND_Y = 540;
        const NANONAUT_Y_VERSNELLING = 1;
        const SPATIEBALK_CODE = 32;
        const NANONAUT_SPRONG_SNELHEID = 20;
        const NANONAUT_X_SNELHEID = 5;
        const ACHTERGROND_BREEDTE = 1000;

        // INSTELLINGEN
        var canvas = document.createElement('canvas');
        var c = canvas.getContext('2d');
        canvas.width = CANVAS_BREEDTE;
        canvas.height = CANVAS_HOOGTE;
        document.body.appendChild(canvas);

        var nanonautAfbeelding = new Image();
        nanonautAfbeelding.src = 'nanonaut.png';

        var achtergrondafbeelding = new Image();
        achtergrondafbeelding.src = 'background.png';

        var nanonautX = CANVAS_BREEDTE / 2; 
        var nanonautY = GROND_Y - NANONAUT_HOOGTE;

        var nanonautYSnelheid = 0;
        var nanonautIsInDeLucht = false
    
        var spatiebalkIsIngedrukt = false;

        var cameraX = 0;
        var cameraY = 0;

        window.addEventListener('keydown', onKeyDown);
        window.addEventListener('keyup', onKeyUp);

        window.addEventListener('load', start);

        function start() {
            window.requestAnimationFrame(hoofdLus);
        }

        // HOOFD-LUS
        function hoofdLus() {
            update();
            draw();
            window.requestAnimationFrame(hoofdLus);
        }

        // SPELER HANDELINGEN

        function onKeyDown(event) {
            if (event.keyCode === SPATIEBALK_CODE) {
                spatiebalkIsIngedrukt = true
            }
        }

        function onKeyUp(event) {
            if (event.keyCode === SPATIEBALK_CODE) {
                spatiebalkIsIngedrukt = false
            }
        }

        // UPDATEN
        function update() {

            nanonautX = nanonautX + NANONAUT_X_SNELHEID;

            if (spatiebalkIsIngedrukt && !nanonautIsInDeLucht){
                // Springen!
                nanonautYSnelheid = -NANONAUT_SPRONG_SNELHEID
                nanonautIsInDeLucht = true
            }

            cameraX = nanonautX - 150;

            nanonautY = nanonautY + nanonautYSnelheid;
            nanonautYSnelheid = nanonautYSnelheid + NANONAUT_Y_VERSNELLING;

            if (nanonautY > (GROND_Y - NANONAUT_HOOGTE)) {
                nanonautY = GROND_Y - NANONAUT_HOOGTE;
                nanonautYSnelheid = 0;
                nanonautIsInDeLucht = false
            }

        }

        // TKEKENEN
        function draw() {
            // Teken de lucht
            c.fillStyle = 'LightSkyBlue';
            c.fillRect(0, 0, CANVAS_BREEDTE, GROND_Y - 40);

            // Teken de achtergrond
            var achtergrondX = -(cameraX % ACHTERGROND_BREEDTE); 
            c.drawImage(achtergrondafbeelding, achtergrondX, -210);
            c.drawImage(achtergrondafbeelding, achtergrondX+ACHTERGROND_BREEDTE, -210);


            // Teken de grond
            c.fillStyle = 'ForestGreen';
            c.fillRect(0, GROND_Y - 40, CANVAS_BREEDTE, CANVAS_HOOGTE - GROND_Y + 40);

            // Teken de Nanonaut
            c.drawImage(nanonautAfbeelding, nanonautX - cameraX, nanonautY - cameraY);
        }
    </script>
</body>

</html>